***chapter6 <输入输出系统 >***
# 6.1 Basis
## 6.1.0 标准术语
- 带宽 Bandwidth
	传输数据的字节数/周期数

- 总线连接串口-键盘鼠标
- 总线连接设备接口-声卡|显卡|网卡
## temp1数据交换方式
- 总述
	与通道方式，外围处理机(有指令集支持)一同协作
	分为
	无条件传输 | 查询方式 | 中断方式 | DMA
- 无条件传送
	双方发送和接受数据都是无条件的
	任何时候想传就传，想收就收
	数据没有传输(接收)完毕的时候就继续传输(接收)
- 查询方式
	微型处理器(例如嵌入式)利用轮询读取**接口内部**的**状态位**(位于状态端口中) 
	用软件来查询
	握手协议类似于TCP协议
	双方利用控制联络信号实现同步也叫**握手**
	因此 联络信号也叫握手信号
	慢但是可靠 CPU效率低
- 中断方式
	由外设引起
	- 接口向CPU提出中断请求(INTR)
		$接口\rightarrow 控制总线 \rightarrow CPU$
	- 中断响应条件
		- 当前指令结束，为了保证异常程序正常返回
		- CPU开中断
	- 中断服务(处理)程序
		
	- 中断返回
	-
	- 补充
		- CSR(Control and Status Register)控制与状态寄存器
			特权指令(由操作系统| 在内核态下的程序执行的指令)
			由特权指令对控制状态寄存器进行**访问和操作**
			包括：
				OF ZF SF IF(中断允许位)
				以上各占一位bit
			
	- 对于单中断系统
		![[Pasted image 20241224175648.png]]
		一次处理一个中断
		其中
		INTR为中断请求信号线 其中包括中断向量号
		INTA是中断响应信号线 其中包括返回地址
		I/O设备会给接口传递位置信息
	- 多级中断<利用中断嵌套操作>
		在接口中，可以按优先级中断其中的程序(由软件实现)
- DMA方式
	中断程序虽然不需要CPU来查询条件,但是最终的数据传输还是要靠CPU执行的中断服务程序来完成
	硬盘主要使用这一种方式
	DMA全称Direct Memory Access 直接内存操作
	信息直接从外设直接到主存Memory不需要中转CPU
	即DMA控制器代替CPU来直接传输
	但不可以按照优先级进行嵌套中断程序
	- 中断与DMA方式的对比
		- 中断是通过CPU执行中断处理程序来传输数据(软件实现)
		- DMA是通过DMA控制器来完成数据传输(硬件实现)
	上一章节所讲的缺页故障程序，是在初始化DMA控制器将总线的控制权抢到给DMA
	- DMA控制器与CPU共享总线的方式
		- CPU暂停方式-对于高速外设
			在CPU访问时，如果DMA要传递数据那么CPU暂停
			利用数据缓冲储存器(在接口设置器中设置一定容量的存储器，传输速度比较快)做桥梁来实现I/O设备与主存之间的数据交换
			即I/O只与数据缓冲存储器交换数据，数据缓冲存储器智育主存交换数据
		- 周期挪用方式-对于中速外设
			当I/O设备无DMA传送请求时，CPU正常访问主存
			但当I/O设备需要使用总线传送数据时，产生DMA请求
			而对于CPU来说 CPU自身会进入一个空闲总线周期状态(DMA控制器挪用CPU的一个总线周期)，DMA控制器因此传送完数据后再将总线权交还给CPU。
			因为数据的准备需要时间，所以这样挪用可以充分利用周期
			I/O设备和CPU同时要访问主存时，I/O设备的优先权高于CPU
		- 交替访问
				比如主存的存取周期为T，而CPU每隔2T才产生一个访存请求
				那么可以将CPU的访问存取和DMA的访问存取交替进行平分2T
- 收尾
	最后检测数据是否有错误(用校验码处理)

# 6.2 总线
- 前引
	由于计算机系统中不同的部件需要通过**信号线**连接起来,然后通过信号线来传送信息
	传输的信息可以被分为 **地址信息 数据信息 控制信息**
	- 总线
		各部件之间**传送信息的公共通路**被称为总线
		只要是在总线上挂着的设备 都可以接收总线上传送来的信息
		注意 要保证任何时候只能有一个设备向总线发送信号
- 总线的分类
	- 内部总线
		主机系统内部各功能模块(部件,板卡)之间的互联
	- 外部总线
		主机系统与 **外设(外部设备)** 或 **其他主机**之间的互联
		其中 专门用于连接主机系统和外设的叫做设备总线
	又可以分为系统总线和局部总线
	- 系统总线(板间总线)
		连接**各个功能板块**(如CPU主存储器,IO接口适配器),进而构成主机系统
	- 片内总线
		连接**芯片内部各功能部件** 例如微型处理器内部使用的总线
	- 板内总线
		连接电路板上各个**集成芯片**
- 总线的术语
	- 总线宽度
		一个总线所设置的**通信线路的数目**
	- 总线带宽
		所能传输的最大数据量/单位时间
- 总线控制器(总线仲裁器)
	用于对总线的使用权进行管理分配
	处于CPU外围 使用广播方式
	例如
		在写回法 写的地址时 MPU在改变内容后 利用广播机制把更改后的地址传给其他MPU
	- 主 从 设备
		在总线控制器的仲裁后获得总线使用权的设备 为 **主设备**
		与主设备进行数据交换的设备 为 **从设备**
	所以利用总线来进行数据传送的设备 在数据传输时要经历以下四个过程
	申请，仲裁，传输，结束
	总线仲裁分为
	- 集中式
		- 并行
			总线请求线，总线应答线是并行关系
		- 串行
			总线请求线是串行关系，总线应答线穿过设备1，设备2一直到设备n
	- 分布式
- 同步总线与异步总线
	- 总线定时
		协调总线上发生的事件的时间顺序与时间长度
		就是协调各种信号在总线上出现和撤销的时机
	- 同步总线
		总线包含一个时钟信号线 该线传递一个方形波信号
		即 时钟信号随数据信号传送
		- 总线周期
			完成一次数据交换所花费的时间
			一个总线周期是由一个或多个时钟周期构成的
	- 异步总线
		总线的一个事件的发生与否，依赖于前一个事件的执行情况
		按照协议来确定电平位数
		例如TCP网络传播协议 ？？
- 常用的总线
	PCI总线
	设备总线
		例如USB(通用串行总线)
- 接口与设备
	- IO接口
		IO设备需要与主机进行有效连接，才能实现数据的输入输出
		但不能直接与主机CPU相联 所以要新增一个中间装置 即 IO接口
		所以CPU(程序)->访问接口->访问外设
		- IO接口的基本功能
			数字转换，数据格式转换
		![[Pasted image 20250108201347.png]]
		















- BIOS
	Basis Input Output System
	是计算机中的一个固件，
	负责在系统启动时初始化硬件，并且提供运行操作系统的基本服务
	基本驱动程序集合